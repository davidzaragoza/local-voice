# LocalVoice

LocalVoice is a lightweight desktop utility for offline voice-to-text transcription. It runs as a floating microphone window and inserts transcribed text into other applications.

Key goal: local-first dictation with no cloud dependency for transcription.

## Features

- Offline speech-to-text using `faster-whisper`
- Push-to-talk from floating window or global hotkey
- Hotkey modes: hold-to-record and toggle
- Recording duration display while dictating
- Hotkey + active profile shown in tooltip
- Multi-profile settings with quick tray profile switching
- Per-profile language and optional translate-to-English mode
- Per-profile model/device selection (`auto`, `cpu`, `cuda`)
- Text injection methods:
  - Clipboard paste
  - Keyboard typing simulation
  - Clipboard with keyboard fallback
- Copy-only mode (copy to clipboard without auto-paste)
- Custom vocabulary:
  - Priority words (prompt hinting)
  - Substitution rules (post-processing replacements)
- Transcription history with search, delete, clear, and JSON export
- Optional start/stop feedback sounds
- Dark and light themes

## Requirements

- Python 3.11+
- PortAudio (for microphone capture via `sounddevice`)

## Installation

### Option 1: Run from source (current workflow)

```bash
# Clone
git clone https://github.com/davidzaragoza/local-voice.git
cd local-voice

# Install dependencies
pip install -r requirements.txt

# Optional: pre-download model(s)
python download_models.py base

# Run
python -m src.main
```

You can also run the entry script:

```bash
python localvoice.py
```

### Option 2: Use prebuilt artifacts (recommended for end users)

Download the latest artifact generated by GitHub Actions (or from Releases when available):

- macOS: `LocalVoice-macOS.zip` (contains `localvoice.app`)
- Windows: `LocalVoice.exe`
- Linux: `LocalVoice`

Artifacts are available in the repository Actions tab for each workflow run.

## macOS permissions

On macOS, grant:

1. Microphone access
2. Accessibility access (for global hotkeys and text injection)
3. Input Monitoring access (for global hotkey listening)

System Settings -> Privacy & Security -> Accessibility
System Settings -> Privacy & Security -> Input Monitoring

Important: grant permissions to the installed `localvoice.app` binary (the one in `/Applications`), not only to your Python interpreter.
The macOS build uses a stable bundle identifier so permissions persist better across updates.

## macOS bundle security troubleshooting

If you install `localvoice.app` and macOS blocks it, try:

1. If macOS says: `"LocalVoice" is damaged and can't be opened`:

```bash
xattr -dr com.apple.quarantine /Applications/localvoice.app
codesign --force --deep --sign - /Applications/localvoice.app
```

2. Re-grant permissions for the installed app path:

- System Settings -> Privacy & Security -> Microphone
- System Settings -> Privacy & Security -> Accessibility
- System Settings -> Privacy & Security -> Input Monitoring

3. If permissions seem stuck, remove `localvoice.app` from those lists, add it again, and restart the app.

## Usage

1. Start recording from the mic button or your configured hotkey.
2. Speak.
3. Stop recording (release hotkey in hold mode, or trigger again in toggle mode).
4. Transcribed text is inserted, or copied only if `copy_only` is enabled.

## Settings Overview

The Settings dialog includes:

- `General`: profiles, startup, language, translation, history, opacity, theme
- `Audio`: input device and start/stop sounds
- `Model`: Whisper model and processing device
- `Hotkey`: recorded combination and hold/toggle mode
- `Injection`: insertion method, copy-only, trailing space, clipboard preservation, typing delay
- `Vocabulary`: custom words and substitutions

## Model Sizes

| Model | Params | Speed | Accuracy |
|-------|--------|-------|----------|
| Tiny | 39M | Fastest | Basic |
| Base | 74M | Fast | Good |
| Small | 244M | Medium | Better |
| Medium | 769M | Slow | High |
| Large v3 | 1550M | Slowest | Best |

## Project Structure

```text
local-voice/
├── src/
│   ├── main.py
│   ├── audio/
│   │   ├── recorder.py
│   │   └── sounds.py
│   ├── gui/
│   │   ├── main_window.py
│   │   ├── settings_dialog.py
│   │   ├── tray_icon.py
│   │   └── themes.py
│   ├── history/
│   │   ├── manager.py
│   │   └── dialog.py
│   ├── hotkey/
│   │   └── manager.py
│   ├── injection/
│   │   └── text_injector.py
│   ├── profiles/
│   │   └── manager.py
│   ├── transcription/
│   │   └── engine.py
│   └── vocabulary/
│       └── manager.py
├── assets/
│   └── bip.wav
├── config/
│   └── settings.json
├── download_models.py
├── localvoice.py
├── requirements.txt
└── pyproject.toml
```

## Technical Stack

| Component | Technology |
|-----------|------------|
| GUI | PySide6 |
| STT | faster-whisper |
| Audio capture | sounddevice |
| Audio I/O | soundfile |
| Hotkeys/input automation | pynput |
| Clipboard | pyperclip |
| Persistence | JSON + SQLite |

## Configuration

Profile-aware settings are stored in `config/settings.json`.

```json
{
  "version": 2,
  "active_profile_id": "default",
  "global": {
    "start_minimized": false,
    "window_opacity": 95,
    "theme": "dark"
  },
  "profiles": [
    {
      "id": "default",
      "name": "Default",
      "settings": {
        "model_size": "base",
        "language": "auto",
        "translate_to_english": false,
        "hotkey": "caps_lock",
        "hotkey_mode": "hold",
        "injection_method": "clipboard",
        "device": "auto",
        "typing_delay": 10,
        "add_trailing_space": true,
        "preserve_clipboard": true,
        "input_device": null,
        "enable_sounds": false,
        "enable_history": true,
        "history_max_entries": 500,
        "vocabulary_words": [],
        "vocabulary_substitutions": {},
        "copy_only": false
      }
    }
  ]
}
```

Related local data:

- Models: `~/.localvoice/models/`
- History database: `~/.localvoice/history.db`
- Logs: `~/.localvoice/logs/localvoice.log`

## Offline Operation

To avoid runtime model downloads:

```bash
# Recommended
python download_models.py base

# Multiple
python download_models.py tiny base small

# All
python download_models.py all
```

## Troubleshooting

Hotkey not working:

- Verify Accessibility and Input Monitoring permissions (especially macOS)
- Check for conflicts with other apps
- Try a simpler combination (`Caps Lock`, `F10`)

No audio recorded:

- Verify microphone permissions
- Select the correct input device in Settings -> Audio
- Confirm PortAudio is installed on the system
- If logs show "Audio signal is near-silent", remove and re-add `localvoice.app` in
  System Settings -> Privacy & Security -> Microphone, then restart the app

Slow transcription:

- Use a smaller model (`tiny` or `base`)
- Use `cuda` device if available
- Close other CPU/GPU heavy applications

## License

MIT License
